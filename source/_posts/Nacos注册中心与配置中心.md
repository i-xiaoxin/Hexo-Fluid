---
title: Nacos注册中心与配置中心
date: 2022-10-08 21:29:02
tags: 
- 微服务
- SpringCloud
- Nacos
index_img: /img/article8.jpg
banner_img: /img/post_banner.jpg
categories:
- 微服务
comment: waline
---

### 一、什么是 Nacos

<p class="note note-success">Nacos /nɑ:kəʊs/ 是 Dynamic Naming and Configuration Service的首字母简称，一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以“服务”为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施。（配置中心和注册中心）</p>

### 二、配置中心基础概述

#### 1.配置

在系统开发过程中，开发者通常会将一些需要变更的参数、变量等从代码中分离出来独立管理，以独立的配置文件的形式存在。目的是让静态的系统工件或者交付物（如 WAR，JAR 包等）更好地和实际的物理运行环境进行适配。配置管理一般包含在系统部署的过程中，由系统管理员或者运维人员完成。配置变更是调整系统运行时的行为的有效手段。

#### 2.为什么要用配置中心？

- **配置实时生效**：传统的静态配置方式要想修改某个配置只能修改之后重新发布应用，要实现动态性，可以选择使用数据库，通过定时轮询访问数据库来感知配置的变化。轮询频率低感知配置变化的延时就长，轮询频率高，感知配置变化的延时就短，但比较损耗性能，需要在实时性和性能之间做折中。**配置中心专门针对这个业务场景，兼顾实时性和一致性来管理动态配置**；
- **配置管理流程**：配置的权限管控、灰度发布、版本管理、格式检验和安全配置等一系列的配置管理相关的特性，也是配置中心不可获取的一部分；
- **分布式场景**：随着采用分布式的开发模式，项目之间的相互引用随着服务的不断增多，相互之间的调用复杂度成指数升高，每次投产或者上线新的项目时苦不堪言，需要引用配置中心治理

#### 3.配置中心支持功能

- **灰度发布**：配置的灰度发布是配置中心比较重要的功能，当配置的变更影响比较大的时候，需要先在部分应用实例中验证配置的变更是否符合预期，然后再推送到所有应用实例。
- **权限管理**：配置的变更和代码变更都是对应用运行逻辑的改变，重要的配置变更常常会带来核弹的效果，对于配置变更的权限管控和审计能力同样是配置中心重要的功能。
- **版本管理&回滚**：当配置变更不符合预期的时候，需要根据配置的发布版本进行回滚。
- **配置格式校验**：应用的配置数据存储在配置中心一般都会以一种配置格式存储，比如Properties、Json、Yaml等，如果配置格式错误，会导致客户端解析配置失败引起生产故障，配置中心对配置的格式校验能够有效防止人为错误操作的发生，是配置中心核心功能中的刚需。
- **监听查询**：当排查问题或者进行统计的时候，需要知道一个配置被哪些应用实例使用到，以及一个实例使用到了哪些配置。
- **多环境**：在实际生产中，配置中心常常需要涉及多环境或者多集群，业务在开发的时候可以将开发环境和生产环境分开，或者根据不同的业务线存在多个生产环境。如果各个环境之间的相互影响比较小（开发环境影响到生产环境稳定性），配置中心可以通过逻辑隔离的方式支持多环境。
- **多集群**：当对稳定性要求比较高，不允许各个环境相互影响的时候，需要将多个环境通过多集群的方式进行物理隔离。

### 三、Nacos安装和启动

#### 1.下载

> 从github上选择需要的版本进行[下载](https://github.com/alibaba/nacos/releases)

![image-20221009162640058](https://raw.githubusercontent.com/i-xiaoxin/image/master/image-20221009162640058.png)

#### 2.解压

```shell
cd /usr/upload
tar -zxvf nacos-server-1.4.1.tar.gz -C /usr/local
```

#### 3.启动和关闭

```shell
cd /usr/local/nacos/bin
#启动
./startup.sh -m standalone #非集群模式启动

#关闭
./shutdown.sh
```

#### 4.测试

浏览器访问：http://host:8848/nacos，出现登录界面即启动成功；默认用户名/密码为： nacos/nacos

### 四、Nacos注册中心

### 1.什么是注册中心

![image-20221009163625094](https://raw.githubusercontent.com/i-xiaoxin/image/master/image-20221009163625094.png)

![image-20221009163709444](https://raw.githubusercontent.com/i-xiaoxin/image/master/image-20221009163709444.png)

注册中心主要有三部分组成：

- **Nacos-Server**：注册中心

​    提供服务的注册和发现。

- **Nacos-Provider**：服务提供方

​    把自身的服务实例注册到 Nacos Server 中

- **Nacos-Consumer**：服务调用方

​    通过 Nacos Server 获取服务列表，消费服务。

### 2.Nacos注册中心使用

#### 2.1创建
